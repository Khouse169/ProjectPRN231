@page
@model Client.Pages.Home.HomePageModel
@{
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Detail</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .story-info {
            float: left; /* Thay đổi float từ left sang right */
            width: 60%;
            padding: 0 20px;
        }

        .story-image {
            float: right; /* Thay đổi float từ right sang left */
            width: 40%;
        }

        .chapter-list {
            clear: both;
            margin-top: 20px; /* Thêm margin-top để tách khoảng cách giữa phần nội dung và danh sách truyện */
            padding-left: 200px
        }

            .chapter-list ul {
                list-style-type: none;
                padding: 0;
            }


    </style>
</head>
<body>
    <div id="storyDetail">
        <!-- Thông tin chi tiết của câu chuyện sẽ được hiển thị ở đây -->
    </div>

    <script>
        $(document).ready(function () {
            // Lấy storyId từ URL
            var urlParams = new URLSearchParams(window.location.search);
            var storyId = urlParams.get('storyId');

            // Nếu storyId không null, thực hiện yêu cầu AJAX
            if (storyId) {
                $.ajax({
                    type: 'GET',
                    url: 'https://localhost:7261/Story/GetStoryById/' + storyId, // Sử dụng endpoint mới
                    success: function (story) {
                        $('#storyDetail').html(`
                                <div class="row">
                                    <div class="col-md-5" style="display: flex; justify-content: center; align-items: center;">
                                        <img src="https://dummyimage.com/200x300/000/fff" style="max-width: 100%; max-height: 100%; object-fit: contain;" />
                                    </div>
                                    <div class="col-md-7">
                                        <div class="story-info">
                                            <h2>${story.title}</h2>
                                            <p><strong>Author:</strong> ${story.author}</p>
                                            <p><strong>Description:</strong> ${story.description}</p>
                                            <p><strong>Publish Date:</strong> ${story.publishDate}</p>
                                            <p><button>Add to library</button></a>
                                            <!-- Các trường thông tin khác của câu chuyện -->
                                        </div>
                                    </div>
                                </div>
                                <div class="chapter-list" style>
                                    <h4>Các chapter</h4>
                                    <ul id="chapterList"></ul>
                                </div>
                                `);
                        $.ajax({
                            type: 'GET',
                            url: 'https://localhost:7261/Story/GetListChapterByStory/' + storyId,
                            success: function (chapters) {
                                chapters.forEach(function (chapter) {
                                    $('#chapterList').append(`<li><a href="/Home/Chapter?chapterId=${chapter.chapterId}&&storyId=${storyId}">${chapter.title}<a/></li>`);
                                });
                            },
                            error: function () {
                                $('#chapterList').append('<li>Failed to load chapters.</li>');
                            }
                        });
                    },
                    error: function () {
                        $('#storyDetail').html('<p>Failed to load story detail.</p>');
                    }
                });
            } else {
                $('#storyDetail').html('<p>StoryId not found in URL.</p>');
            }
        });
    </script>
</body>
</html>
